<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - FocusFree</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary: #4CAF50;
            --secondary: #2196F3;
            --danger: #f44336;
            --success: #4CAF50;
            --warning: #ff9800;
            --light: #f8f9fa;
            --dark: #343a40;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
        }
        .dashboard-card {
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border: none;
            margin-bottom: 20px;
            transition: transform 0.3s;
        }
        .dashboard-card:hover {
            transform: translateY(-5px);
        }
        .app-card {
            border-left: 4px solid var(--primary);
            margin-bottom: 15px;
            transition: all 0.3s;
        }
        .app-card.limit-reached {
            border-left-color: var(--danger);
            background-color: #fff5f5;
        }
        .app-card.active {
            border-left-color: var(--success);
            background-color: #f0fff4;
        }
        .progress-thin {
            height: 8px;
            border-radius: 4px;
        }
        .usage-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            margin: 0 auto;
            border: 8px solid #e9ecef;
        }
        .nav-tabs .nav-link.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <i class="fas fa-brain me-2"></i>FocusFree
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="index.html">Home</a>
                <a class="nav-link active" href="dashboard.html">Dashboard</a>
                <a class="nav-link" href="statistics.html">Statistics</a>
                <a class="nav-link" href="settings.html">Settings</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Daily Overview -->
        <div class="row">
            <div class="col-lg-8">
                <div class="dashboard-card card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="fas fa-tachometer-alt me-2"></i>Daily Overview</h5>
                    </div>
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-4 text-center">
                                <div class="usage-circle">
                                    <div>
                                        <span id="dailyUsage">0</span>
                                        <small class="d-block text-muted">minutes</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-8">
                                <h6>Daily Progress</h6>
                                <div class="progress progress-thin mb-2">
                                    <div id="dailyProgressBar" class="progress-bar bg-success" 
                                         role="progressbar" style="width: 0%"></div>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <small>Limit: <span id="dailyLimitDisplay">240</span> min</small>
                                    <small>Remaining: <span id="remainingTime">240</span> min</small>
                                </div>
                                <div class="mt-3">
                                    <div class="input-group">
                                        <input type="number" id="newDailyLimit" class="form-control" 
                                               placeholder="New daily limit" min="30" max="1440">
                                        <button class="btn btn-outline-primary" onclick="updateLimit()">
                                            Update
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-4">
                <div class="dashboard-card card">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0"><i class="fas fa-plus-circle me-2"></i>Add New App</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <input type="text" id="appNameInput" class="form-control mb-2" 
                                   placeholder="App name (e.g., Instagram)">
                            <div class="row g-2 mb-2">
                                <div class="col">
                                    <input type="number" id="appLimitInput" class="form-control" 
                                           placeholder="Limit (min)" min="1" max="1440">
                                </div>
                                <div class="col">
                                    <select id="appCategory" class="form-control">
                                        <option value="Social">Social</option>
                                        <option value="Entertainment">Entertainment</option>
                                        <option value="Productivity">Productivity</option>
                                        <option value="Games">Games</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                            </div>
                            <button class="btn btn-success w-100" onclick="addNewApp()">
                                <i class="fas fa-plus me-1"></i>Add App
                            </button>
                        </div>
                        <div class="text-center">
                            <small class="text-muted">Popular presets:</small>
                            <div class="btn-group btn-group-sm mt-1 w-100">
                                <button class="btn btn-outline-secondary" onclick="addPreset('Instagram', 60, 'Social')">
                                    Instagram
                                </button>
                                <button class="btn btn-outline-secondary" onclick="addPreset('YouTube', 90, 'Entertainment')">
                                    YouTube
                                </button>
                                <button class="btn btn-outline-secondary" onclick="addPreset('TikTok', 45, 'Social')">
                                    TikTok
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- App Management -->
        <div class="dashboard-card card mt-4">
            <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="fas fa-mobile-alt me-2"></i>App Management</h5>
                <span class="badge bg-light text-dark" id="appCount">0 apps</span>
            </div>
            <div class="card-body">
                <!-- Tabs -->
                <ul class="nav nav-tabs mb-3" id="appTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="all-tab" data-bs-toggle="tab" 
                                data-bs-target="#all" type="button">All Apps</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="active-tab" data-bs-toggle="tab" 
                                data-bs-target="#active" type="button">Active</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="limited-tab" data-bs-toggle="tab" 
                                data-bs-target="#limited" type="button">Limit Reached</button>
                    </li>
                </ul>
                
                <!-- Tab Content -->
                <div class="tab-content" id="appTabsContent">
                    <div class="tab-pane fade show active" id="all" role="tabpanel">
                        <div id="appList">
                            <!-- Apps will be loaded here -->
                            <div class="text-center text-muted py-5">
                                <i class="fas fa-mobile-alt fa-3x mb-3"></i>
                                <p>No apps added yet. Add your first app above!</p>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="active" role="tabpanel">
                        <div id="activeAppsList"></div>
                    </div>
                    <div class="tab-pane fade" id="limited" role="tabpanel">
                        <div id="limitedAppsList"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="dashboard-card card">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0"><i class="fas fa-chart-pie me-2"></i>Quick Stats</h5>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-4">
                                <h3 id="totalApps">0</h3>
                                <small class="text-muted">Apps</small>
                            </div>
                            <div class="col-4">
                                <h3 id="totalLimit">0</h3>
                                <small class="text-muted">Total Limit</small>
                            </div>
                            <div class="col-4">
                                <h3 id="totalUsed">0</h3>
                                <small class="text-muted">Used Today</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="dashboard-card card">
                    <div class="card-header bg-danger text-white">
                        <h5 class="mb-0"><i class="fas fa-exclamation-triangle me-2"></i>Quick Actions</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-outline-warning w-100 mb-2" onclick="resetAllUsage()">
                            <i class="fas fa-redo me-1"></i>Reset Today's Usage
                        </button>
                        <button class="btn btn-outline-danger w-100" onclick="clearAllData()">
                            <i class="fas fa-trash me-1"></i>Clear All Data
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white py-3 mt-5">
        <div class="container text-center">
            <p class="mb-0">&copy; 2024 FocusFree - Digital Wellbeing Application</p>
            <p class="text-muted mb-0">Dashboard v1.0 | Real-time Tracking</p>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/app.js"></script>
    <script>
        // Dashboard functionality
        let timers = {};
        
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            updateDashboard();
            setInterval(updateDashboard, 1000); // Update every second
        });
        
        // Update dashboard display
        function updateDashboard() {
            const state = window.FocusFree.getState();
            const stats = window.FocusFree.getStats();
            
            // Update daily overview
            document.getElementById('dailyUsage').textContent = state.dailyUsage;
            document.getElementById('dailyLimitDisplay').textContent = state.dailyLimit;
            document.getElementById('remainingTime').textContent = stats.remainingDaily;
            
            // Update progress bar
            const progressPercent = Math.min((state.dailyUsage / state.dailyLimit) * 100, 100);
            const progressBar = document.getElementById('dailyProgressBar');
            progressBar.style.width = `${progressPercent}%`;
            progressBar.textContent = `${Math.round(progressPercent)}%`;
            progressBar.className = `progress-bar ${state.dailyUsage >= state.dailyLimit ? 'bg-danger' : 'bg-success'}`;
            
            // Update quick stats
            document.getElementById('totalApps').textContent = stats.totalApps;
            document.getElementById('totalLimit').textContent = stats.totalLimit;
            document.getElementById('totalUsed').textContent = stats.totalUsage;
            document.getElementById('appCount').textContent = `${stats.totalApps} apps`;
            
            // Render app list
            renderAppList();
        }
        
        // Render all apps
        function renderAppList() {
            const apps = window.FocusFree.getState().apps;
            const appList = document.getElementById('appList');
            const activeList = document.getElementById('activeAppsList');
            const limitedList = document.getElementById('limitedAppsList');
            
            if (apps.length === 0) {
                appList.innerHTML = `
                    <div class="text-center text-muted py-5">
                        <i class="fas fa-mobile-alt fa-3x mb-3"></i>
                        <p>No apps added yet. Add your first app above!</p>
                    </div>`;
                activeList.innerHTML = '<p class="text-muted text-center py-3">No active apps</p>';
                limitedList.innerHTML = '<p class="text-muted text-center py-3">No apps at limit</p>';
                return;
            }
            
            // All apps
            appList.innerHTML = apps.map(app => createAppCard(app)).join('');
            
            // Active apps
            const activeApps = apps.filter(app => app.isActive);
            activeList.innerHTML = activeApps.length > 0 
                ? activeApps.map(app => createAppCard(app)).join('')
                : '<p class="text-muted text-center py-3">No active apps</p>';
            
            // Limited apps
            const limitedApps = apps.filter(app => app.usage >= app.limit);
            limitedList.innerHTML = limitedApps.length > 0
                ? limitedApps.map(app => createAppCard(app)).join('')
                : '<p class="text-muted text-center py-3">No apps at limit</p>';
        }
        
        // Create app card HTML
        function createAppCard(app) {
            const progressPercent = Math.min((app.usage / app.limit) * 100, 100);
            const isAtLimit = app.usage >= app.limit;
            
            return `
                <div class="app-card card ${isAtLimit ? 'limit-reached' : ''} ${app.isActive ? 'active' : ''}">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-3">
                                <h6 class="mb-1">${app.name}</h6>
                                <span class="badge bg-secondary">${app.category}</span>
                            </div>
                            <div class="col-md-4">
                                <div class="d-flex align-items-center">
                                    <div class="flex-grow-1">
                                        <div class="progress progress-thin mb-1">
                                            <div class="progress-bar ${isAtLimit ? 'bg-danger' : 'bg-success'}" 
                                                 style="width: ${progressPercent}%"></div>
                                        </div>
                                        <small class="text-muted">${app.usage} / ${app.limit} minutes</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 text-center">
                                <div class="btn-group">
                                    <button class="btn btn-sm ${app.isActive ? 'btn-danger' : 'btn-success'}" 
                                            onclick="toggleTimer(${app.id})">
                                        <i class="fas ${app.isActive ? 'fa-stop' : 'fa-play'} me-1"></i>
                                        ${app.isActive ? 'Stop' : 'Start'}
                                    </button>
                                    <button class="btn btn-sm btn-outline-warning" onclick="resetApp(${app.id})">
                                        <i class="fas fa-redo"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-2 text-end">
                                <button class="btn btn-sm btn-outline-danger" onclick="removeApp(${app.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>`;
        }
        
        // Add new app
        function addNewApp() {
            const name = document.getElementById('appNameInput').value.trim();
            const limit = parseInt(document.getElementById('appLimitInput').value);
            const category = document.getElementById('appCategory').value;
            
            if (!name || !limit || limit < 1) {
                alert('Please enter a valid app name and limit (minimum 1 minute)');
                return;
            }
            
            window.FocusFree.addApp(name, limit, category);
            
            // Clear inputs
            document.getElementById('appNameInput').value = '';
            document.getElementById('appLimitInput').value = '';
            
            updateDashboard();
            alert(`"${name}" added with ${limit}-minute limit!`);
        }
        
        // Add preset app
        function addPreset(name, limit, category) {
            window.FocusFree.addApp(name, limit, category);
            updateDashboard();
            alert(`"${name}" preset added!`);
        }
        
        // Update daily limit
        function updateLimit() {
            const newLimit = parseInt(document.getElementById('newDailyLimit').value);
            if (newLimit >= 30 && newLimit <= 1440) {
                window.FocusFree.updateDailyLimit(newLimit);
                updateDashboard();
                alert(`Daily limit updated to ${newLimit} minutes!`);
                document.getElementById('newDailyLimit').value = '';
            } else {
                alert('Please enter a limit between 30 and 1440 minutes');
            }
        }
        
        // Toggle timer for app
        function toggleTimer(appId) {
            const app = window.FocusFree.getApp(appId);
            if (!app) return;
            
            const state = window.FocusFree.getState();
            
            if (app.isActive) {
                // Stop timer
                clearInterval(timers[appId]);
                delete timers[appId];
                app.isActive = false;
            } else {
                // Check limits
                if (state.dailyUsage >= state.dailyLimit) {
                    alert('Daily limit reached! Please increase your limit or try tomorrow.');
                    return;
                }
                if (app.usage >= app.limit) {
                    alert(`Limit reached for ${app.name}! Reset or increase limit to continue.`);
                    return;
                }
                
                // Start timer (for demo: 1 second = 1 minute)
                app.isActive = true;
                timers[appId] = setInterval(() => {
                    app.usage++;
                    state.dailyUsage++;
                    
                    // Update UI
                    updateDashboard();
                    window.FocusFree.saveToStorage();
                    
                    // Check limits
                    if (app.usage >= app.limit) {
                        clearInterval(timers[appId]);
                        delete timers[appId];
                        app.isActive = false;
                        alert(`Time limit reached for ${app.name}!`);
                        updateDashboard();
                    }
                    
                    if (state.dailyUsage >= state.dailyLimit) {
                        // Stop all timers
                        Object.values(timers).forEach(timer => clearInterval(timer));
                        timers = {};
                        state.apps.forEach(a => a.isActive = false);
                        alert('Daily limit reached! All timers stopped.');
                        updateDashboard();
                    }
                }, 1000); // 1 second for demo (1000ms = 1 second)
            }
            
            window.FocusFree.saveToStorage();
            updateDashboard();
        }
        
        // Reset app usage
        function resetApp(appId) {
            const app = window.FocusFree.getApp(appId);
            if (app) {
                const state = window.FocusFree.getState();
                state.dailyUsage -= app.usage;
                app.usage = 0;
                
                // Stop timer if active
                if (app.isActive && timers[appId]) {
                    clearInterval(timers[appId]);
                    delete timers[appId];
                    app.isActive = false;
                }
                
                window.FocusFree.saveToStorage();
                updateDashboard();
                alert(`${app.name} usage reset to 0!`);
            }
        }
        
        // Remove app
        function removeApp(appId) {
            if (confirm('Are you sure you want to remove this app?')) {
                window.FocusFree.removeApp(appId);
                updateDashboard();
            }
        }
        
        // Reset all usage
        function resetAllUsage() {
            if (confirm('Reset today\'s usage for all apps?')) {
                const state = window.FocusFree.getState();
                
                // Stop all timers
                Object.values(timers).forEach(timer => clearInterval(timer));
                timers = {};
                
                // Reset usage
                state.dailyUsage = 0;
                state.apps.forEach(app => {
                    app.usage = 0;
                    app.isActive = false;
                });
                
                window.FocusFree.saveToStorage();
                updateDashboard();
                alert('All usage data reset!');
            }
        }
        
        // Clear all data
        function clearAllData() {
            if (confirm('Delete ALL data including app settings? This cannot be undone!')) {
                // Stop all timers
                Object.values(timers).forEach(timer => clearInterval(timer));
                timers = {};
                
                // Clear localStorage
                localStorage.clear();
                
                // Reload page
                location.reload();
            }
        }
    </script>
</body>
</html>
